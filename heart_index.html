<!DOCTYPE html>
<html lang="en" style="height:100%">
	<head>
		<title>Silo6_heart</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Helvetica;
				font-size: 100%;
				background-color: #000;
				color: #fff;
				margin: 0px;
				overflow: hidden;
			}
		</style>
		<link rel="stylesheet" href="styles/new_style.css">
		<link href="http://netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<script src="js/three.min.js"></script>
		<script src="js/zinc_threejs_control.js"></script>
		<script src="js/zinc_3js_renderer.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> 
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/dojo.js" data-dojo-config="async: 1, parseOnLoad: true" ></script>	
		<script src="js/jquery.wheel.js"></script>
		<script>
			var dojoConfig = {
		        async: true,
		        // This code registers the correct location of the "demo" package
		        // so we can load Dojo from the CDN whilst still being able to
		        // load local modules
		        packages: [{
		            name: "js",
		            location: location.pathname.replace(/\/[^/]+$/, '')  + '/js'
		        }]
			};
		</script>
	</head>
	<body style='height:100%;font-family="Helvetica"'>
	<div id="main_page" class="heartpage">
		<div id="footMore" class="open">
			<div style="position:absolute;left:5%">
				<img src="images/new_image/click2.png" alt="more" style="float:left;width:60%">
			</div>
			<div style="position:absolute;right:5%">
				<img src="images/new_image/spin2.png" alt="more" style="float:right;width:60%">
			</div>
		</div>
		
		<div id="rightInformation" class="open">
			<div class="rightChartTitle" style = "width:75%;float:right;padding:10px">
				<b>ECG</b>
			</div>
			<div id="rightECG" class="rightChart" style="width:75%;float:right;padding:10px">
			</div>
			<div id="ECGDescription" class="rightChartDescription" style="width:75%;clear:right;float:right;padding:10px">
				electrical pulses make the heart muscle contract
			</div>
			<div class="rightChartTitle" style="top:6%;width:75%;float:right;padding:10px">
				<b>Pressure</b>
			</div>
			<div id="rightLVP" class="rightChart"  style="top:6%;float:right">
			</div>
			<div id="LVPDescription" class="rightChartDescription" style="top:6%;clear:right;width:75%;float:right;padding:10px">
				muscle contraction generates pump pressure
			</div>
			<div class="rightChartTitle" style = "top:10%;width:75%;float:right;padding:10px;clear:right">
				<b>Heart Rate</b>
			</div>
			<div id="rightRate" style = "top:10%;width:75%;clear:right;float:right;padding:10px">
				<input id="speed_slider" type="range" min="0" max="5000" value ="1000" step="1" oninput="updateSlider(this.value)" style="width:80%;"/>
			</div>
			<div class="rightChartDescription" style="top:10%;width:75%;clear:right;float:right;padding:10px">
				make the heart beat faster or slower
			</div>
		</div>
		
		<div id="bottom_control" class="closed">
			<div id="home_icon" class="closed" style="left:0%;bottom:0%;position:absolute;z-index:10;height:75%;">
				<img src="images/new_image/home.png" alt="home"  onclick="homeClicked()" style="max-height:100%;">
			</div>
			<div id="home_selected_icon" class="open" style="left:0%;bottom:0%;position:absolute;z-index:10;height:75%;">
				<img src="images/new_image/home_selected.png" alt="home"  onclick="homeClicked()" style="max-height:100%;">
			</div>
			<div id="halfHeart" class="halfHeart closed" style="right:2%;bottom:0%;position:absolute;z-index:10;height:75%;">
				<img src="images/new_image/half_heart.png" alt="halfHeart" style="max-height:100%;" onclick="halfHeartPressed()">
			</div>
			<div id="fibrillation_icon" class="bottomButton open" style="left:10%;bottom:0%;position:absolute;z-index:10;height:75%;">
				<img src="images/heart_v7/fibrillation_icon.png" alt="information" style="max-height:100%;" onclick="heartElectricityClicked()">
			</div>
			<div id="attack_icon" lass="bottomButton open" style="left:20%;bottom:0%;position:absolute;z-index:10;height:75%;">
				<img src="images/heart_v7/attack_icon.png" alt="information" style="max-height:100%;" onclick="heartAttackClicked()">
			</div>
			<div id="failure_icon" class="bottomButton open" style="left:30%;bottom:0%;position:absolute;z-index:10;height:75%;">
				<img src="images/heart_v7/failure_icon.png" alt="information" style="max-height:100%;" onclick="heartFailureClicked()">
			</div>
			<div id="fibrillation_selected_icon" class="bottomButton closed" style="left:10%;bottom:0%;position:absolute;z-index:10;height:75%;">
				<img src="images/heart_v7/fibrillation_selected_icon.png" alt="information" style="max-height:100%;">
			</div>
			<div id="attack_selected_icon" class="bottomButton closed" style="left:20%;bottom:0%;position:absolute;z-index:10;height:75%;">
				<img src="images/heart_v7/attack_selected_icon.png" alt="information" style="max-height:100%;">
			</div>
			<div id="failure_selected_icon" class="bottomButton closed" style="left:30%;bottom:0%;position:absolute;z-index:10;height:75%;">
				<img src="images/heart_v7/failure_selected_icon.png" alt="information" style="max-height:100%;">
			</div>
			<div id="fullHeart" class="halfHeart closed" style="right:2%;bottom:0%;position:absolute;z-index:10;height:75%;"">
				<img src="images/new_image/full_heart.png" alt="fullHeart"  style="max-height:100%;"onclick="halfHeartPressed()">
			</div>
		</div>
		
		<div id="initialNormal" class="closed leftPanel">
			<div class="leftTitle" style="color:#00ccff" >
				<b>The Heart</b>
			</div>
			<div class="leftDescription" style="color:#00ccff">
				<b>Muscles pumping blood</b>
			</div>
			<div class="leftDetail" style="color:rgb(175, 175, 175);">
				<p>The main job of the heart is to pump blood around the body to meet the demands of the organ systems.</p>
				<p>The main pumping chambers of the heart are the left and right ventricles.</p>
				<p>Contraction of the thick muscular walls of the ventricles generates the pressure needed to pump blood around the body.</p>
			</div>
			<div class="leftFootnote" style="color:rgb(255, 255, 255);">
				<b>
				<p>Select below to learn about some common heart problems.</p>
				<b>

			</div>
		</div>
		
		<div id="leftHeartElectricity" class="closed leftPanel">
			<div class="leftTitle" style="color:rgb(255,192,0);" >
				<b>Heart Electricity</b>
			</div>
			<div class="leftDescription" style="color:rgb(255,192,0);">
				<b>Coordinated contraction</b>
			</div>
			<div class="leftDetail" style="color:rgb(175, 175, 175);">
				In a healthy heart, electrical waves pass smoothly through the muscle to provide coordinated contraction and efficient pumping.
			</div>
			<div class="leftClickable" onclick="arrhythmiaClicked()">
				<b>What happens when the smooth electrical waves are disrupted?</b>
			</div>
			<div class="leftProgressBar">
				<img src="images/heart_v7/health_electricity.png" alt="information" style="width:70%;">
			</div>
		</div>
		
		<div id="leftHeartArrhythmia" class="closed leftPanel">
			<div class="leftTitle" style="color:rgb(255,192,0);" >
				<b>Fibrillation</b>
			</div>
			<div class="leftDescription" style="color:rgb(255,192,0);">
				<b>Chaotic contraction</b>
			</div>
			<div class="leftDetail" style="color:rgb(175, 175, 175);">
				<p>Electrical disruption leads to fibrillation and chaotic contraction. This means the heart cannot generate enough pressure to pump the blood.</p>
				<p>To fix a fibrillating heart, we need to apply a large electrical shock to reset the electrical waves. We need an Automated External Defibrillator (AED).</p>
			</div>
			<div class="leftClickable" style="font-size:2em" onclick="AEDClicked()">
				<b>Defibrillate</b>
			</div>
			<div class="leftProgressBar">
				<img src="images/heart_v7/fibrillation_electricity.png" alt="information" style="width:90%" >
			</div>
		</div>
	
		<div id="leftHeartAttack" class="closed leftPanel">
			<div class="leftTitle" style="color:rgb(106,236,8);" >
				<b>Healthy Heart</b>
			</div>
			<div class="leftDescription" style="color:rgb(106,236,8);">
				<b>Healthy muscle</b>
			</div>
			<div id="NormalHeartAttackDetail" class="leftDetail" style="color:rgb(175, 175, 175);">
				The heart muscle needs blood to survive. The healthy heart pumps blood to nourish itself through its coronary arteries.
			</div>
			
			<div class="leftClickable" onclick="heartAttackStagePressed('SmallInfarct', 'MildHeartAttack', 'leftModerateAttack')">
				<b>What happens during a heart attack?</b>
			</div>
			<div class="leftProgressBar">
				<img src="images/heart_v7/health_attack.png" alt="information" style="width:90%">
			</div>		
		</div>
		
		
		<div id="leftModerateAttack" class="closed leftPanel">
			<div class="leftTitle" style="color:rgb(106,236,8);" >
				<b>Heart Attack</b>
			</div>
			<div class="leftDescription" style="color:rgb(106,236,8);">
				<b>Damaged muscle</b>
			</div>
			<div id="NormalHeartAttackDetail" class="leftDetail" style="color:rgb(175, 175, 175);">
				In a heart attack, blocked arteries lead to muscle damage, which reduces the heartâ€™s ability to pump blood.
			</div>
			<div class="leftLargeClickable">
				<img src="images/heart_v7/medication.png" alt="information" style="max-width:100%;max-height:100%;" onclick="heartAttackStagePressed('NoInfarct', 'NoHeartAttack', 'leftHeartAttack')">
			</div>
			<div class="leftClickable"  onclick="heartAttackStagePressed('LargeInfarct', 'SevereHeartAttack', 'leftSevereAttack')" >
				<b>What happens if you don't take your medication?</b>
			</div>
			<div class="leftProgressBar">
				<img src="images/heart_v7/moderate_attack.png" alt="information" style="width:90%">
			</div>
		</div>
		
		<div id="leftSevereAttack" class="closed leftPanel">
			<div class="leftTitle" style="color:rgb(106,236,8);" >
				<b>Heart Attack</b>
			</div>
			<div class="leftDescription" style="color:rgb(106,236,8);">
				<b>Severe muscle damage</b>
			</div>
			<div id="NormalHeartAttackDetail" class="leftDetail" style="color:rgb(175, 175, 175);">
				If blocked arteries are left untreated, more of the muscle gets damaged, and the pumping ability of the heart is severely reduced.
			</div>
			<div class="leftLargeClickable">
				<img src="images/heart_v7/medication.png" alt="information" style="max-width:100%;max-height:100%;"  onclick="heartAttackStagePressed('NoInfarct', 'NoHeartAttack', 'leftHeartAttack')">
			</div>
			<div class="leftProgressBar">
				<img src="images/heart_v7/severe_attack.png" alt="information" style="width:90%">
			</div>
		</div>
	
		<div id="more" class="closed" onclick="moreClicked()">
			<img src="images/more.png" alt="more" style="height:40%;">
		</div>

		
		<div id="myRenderer" class="open">
		</div>

		<script>
			$(document).ready(function() {
  				$(".trigger").click(function() {
    					$(".menu").toggleClass("active"); 
  				});
			});
		</script>
	</div>
	
	<script>
		var ECGchart = undefined;
		var LVPchart = undefined;
		var ECGurls = [];
		var LVPurls = [];
		var ECGs = [];
		var LVPs = [];
		var ECGTexts = [];
		var LVPTexts = [];
		var modelURLsArray = [];
		var currentECGName = 'None';
		var currentLVPName = 'None';
		var ecgIndicator = undefined;
		var lvpIndicator = undefined;
		var maxECGTime = 0.0, maxLVPTime = 0.0;
		var minECGTime = 0.0, minLVPTime = 0.0
		var timeLineOffset = 0.0;
		setUpArrays();
		var container = document.getElementById('myRenderer')
		var zincRenderer = new Zinc.Renderer(container, window);
		Zinc.defaultMaterialColor = 0xFFFF9C;
		zincRenderer.initialiseVisualisation();
		zincRenderer.getThreeJSRenderer().setClearColor( 0xffffff, 0);
		var halfHeartFlag = false;
		var leftPanelIDs = ["initialNormal", "leftHeartElectricity", "leftHeartArrhythmia", "leftHeartAttack",
			"leftModerateAttack", "leftSevereAttack"];
		var idleTime = 0;
		var idleTimeLimit = 120000;
		var oldTime = new Date();
		var iconIds = ["fibrillation_icon", "attack_icon", "failure_icon", "fibrillation_selected_icon",
			"attack_selected_icon", "failure_selected_icon", "home_icon", "home_selected_icon"];

		function displayHalfHeartIcon() {
			if (halfHeartFlag) {
				document.getElementById('halfHeart').classList.remove('open');
				document.getElementById('halfHeart').classList.add('closed');
				document.getElementById('fullHeart').classList.remove('closed');
				document.getElementById('fullHeart').classList.add('open');
			} else {
				document.getElementById('halfHeart').classList.remove('closed');
				document.getElementById('halfHeart').classList.add('open');
				document.getElementById('fullHeart').classList.remove('open');
				document.getElementById('fullHeart').classList.add('closed');
			}
		}
		
		function idleTimerReached() {
			if (document.getElementById('footMore').classList.contains('closed')) {
				leftPanelTrigger(undefined);
				document.getElementById('rightInformation').className = 'closed';
				document.getElementById('footMore').className = 'open';
				document.getElementById('bottom_control').className = 'closed';
				document.getElementById('halfHeart').classList.remove('open');
				document.getElementById('halfHeart').classList.add('closed');
				document.getElementById('fullHeart').classList.remove('open');
				document.getElementById('fullHeart').classList.add('closed');
				loadModel("DeformingHeart", 1.0);
			}
		}
		
		function homeClicked() {
			if (document.getElementById('initialNormal').classList.contains('closed')) {
				showIcons("fibrillation_icon", "attack_icon", "failure_icon");
				leftPanelTrigger("initialNormal");
				document.getElementById('footMore').className = 'closed';
				document.getElementById('halfHeart').classList.remove('open');
				document.getElementById('halfHeart').classList.add('closed');
				document.getElementById('fullHeart').classList.remove('open');
				document.getElementById('fullHeart').classList.add('closed');
				loadModel("DeformingHeart", 1.0);
				document.getElementById("home_icon").className = 'closed';
				document.getElementById("home_selected_icon").className = 'open';
			}
		}
		
		function leftPanelTrigger(elementIdToDisplay) {
			for(var i = 0; i < leftPanelIDs.length; i++){
    			var id = leftPanelIDs[i];
				document.getElementById(id).classList.remove('open');
				document.getElementById(id).classList.add('closed');
			}
			if (elementIdToDisplay) {
				document.getElementById(elementIdToDisplay).classList.remove('closed');
				document.getElementById(elementIdToDisplay).classList.add('open');
			}
		}
		
		var pageClicked = function() {
			if (document.getElementById('footMore').className == 'open'){
				showIcons("fibrillation_icon", "attack_icon", "failure_icon");
				leftPanelTrigger('initialNormal');
				document.getElementById('footMore').className = 'closed';
				document.getElementById('rightInformation').className = 'open';
				document.getElementById('bottom_control').className = 'open';
				displayHalfHeartIcon();
				showECGAndLVP("Normal", -0.075);
			}
		}
		
		function showIcons(showIcon1, showIcon2, showIcon3) {
			for(var i = 0; i < leftPanelIDs.length; i++){
    			var id = iconIds[i];
    			if ((id != showIcon1) && (id != showIcon2) && (id != showIcon3)) {
					document.getElementById(id).classList.remove('open');
					document.getElementById(id).classList.add('closed');
				}
			}
			if (document.getElementById(showIcon1).classList.contains('closed')) {
				document.getElementById(showIcon1).classList.remove('closed');
				document.getElementById(showIcon1).classList.add('open');
			}
			if (document.getElementById(showIcon2).classList.contains('closed')) {
				document.getElementById(showIcon2).classList.remove('closed');
				document.getElementById(showIcon2).classList.add('open');
			}
			if (document.getElementById(showIcon3).classList.contains('closed')) {
				document.getElementById(showIcon3).classList.remove('closed');
				document.getElementById(showIcon3).classList.add('open');
			}
		}
		
		function heartElectricityClicked() {
			leftPanelTrigger('leftHeartElectricity');
			showIcons("fibrillation_selected_icon", "attack_icon", "failure_icon");
			document.getElementById("home_icon").className = 'open';
			document.getElementById("home_selected_icon").className = 'closed';
			loadModel('NormalElectricity', 1.0);
			showECGAndLVP('Normal', 0.0);
		}
		
		function arrhythmiaClicked() {
			leftPanelTrigger('leftHeartArrhythmia');
			loadModel('ArrythmiaElectricity', 0.25);
			showECGAndLVP('Arrhythmia', 0.0);
		}
		
		function AEDClicked() {
			leftPanelTrigger('leftHeartElectricity');
			loadModel('NormalElectricity', 1.0);
			showECGAndLVP('Normal', 0.0);
		}
		
		var heartAttackStagePressed = function(StageName, pressedElement, descriptionId) {
			loadModel(StageName, 1.0);
			showECGAndLVP(StageName, 0.0);
			document.getElementById('leftHeartAttack').classList.remove('open');
			document.getElementById('leftHeartAttack').classList.add('closed');
			document.getElementById('leftModerateAttack').classList.remove('open');
			document.getElementById('leftModerateAttack').classList.add('closed');
			document.getElementById('leftSevereAttack').classList.remove('open');
			document.getElementById('leftSevereAttack').classList.add('closed');
			document.getElementById(descriptionId).classList.remove('closed');
			document.getElementById(descriptionId).classList.add('open');
		}
		
		function heartAttackClicked() {
			showIcons("fibrillation_icon", "attack_selected_icon", "failure_icon");
			document.getElementById("home_icon").className = 'open';
			document.getElementById("home_selected_icon").className = 'closed';
			leftPanelTrigger('leftHeartAttack');
			heartAttackStagePressed('NoInfarct','NoHeartAttack', 'leftHeartAttack');
		}
		
		var dragFlag = 0;
		container.addEventListener("mousedown", function() {flag = 0; idleTime = 0;oldTime = new Date(); }, false);
		container.addEventListener("mousemove", function() {flag = 1; idleTime = 0;oldTime = new Date();}, false);
		container.addEventListener("mouseup", function(){idleTime = 0;oldTime = new Date();
		    if(flag === 0){pageClicked();}}, false);
		
		loadModel("DeformingHeart", 1.0);
		zincRenderer.animate();
		document.getElementById("speed_slider").value = 1000;
		
		var updateIndicatorsAndTimer = function() {
			var newTime = new Date();
			idleTime = idleTime + newTime.getTime() - oldTime.getTime();
			oldTime = newTime;
			if (idleTime > idleTimeLimit) {
				idleTimerReached();
			}
		
			var normaliseTime = zincRenderer.getCurrentTime() / 3000.0;
			if (lvpIndicator && (currentLVPName != ' None') &&
				ecgIndicator && (currentECGName != ' None') &&
				document.getElementById('rightInformation').className.includes("open")) {
				var lvpTime = normaliseTime * (maxLVPTime - minLVPTime) + minLVPTime;
				var ecgTime = normaliseTime * (maxECGTime - minECGTime) + minECGTime;
				if (timeLineOffset != 0.0) {
        			lvpTime = lvpTime + timeLineOffset;
        			ecgTime = ecgTime + timeLineOffset;
        			if (lvpTime > maxLVPTime) {
        				lvpTime = lvpTime - maxLVPTime + minLVPTime;
        			} else if ( lvpTime < minLVPTime) {
        				lvpTime = maxLVPTime - (minLVPTime - lvpTime);
        			}
        			if (ecgTime > maxECGTime) {
        				ecgTime = ecgTime - maxECGTime + minECGTime;
        			} else if ( ecgTime < minECGTime) {
        				ecgTime = maxECGTime - (minECGTime - ecgTime);
        			}
        		}
        		lvpIndicator.opt.values = [lvpTime];
        		ecgIndicator.opt.values = [ecgTime];
        		lvpIndicator.dirty = true;
        		lvpIndicator.render();
        		ecgIndicator.dirty = true;
        		ecgIndicator.render();
			}
		}
		
		zincRenderer.addPreRenderCallbackFunction(updateIndicatorsAndTimer);
		
		function geometryShowHalf() {
			return function(zincGeometry) {
				if (zincGeometry.groupName && zincGeometry.groupName.includes("Post")) {
					zincGeometry.setVisibility(!halfHeartFlag);
				}
			}
		}
		
		function showHalf() {
			var currentScene = zincRenderer.getCurrentScene();
			currentScene.forEachGeometry(geometryShowHalf());
		}
		
		var halfHeartPressed = function() {
			if (halfHeartFlag) {
				halfHeartFlag = false;
			} else {
				halfHeartFlag = true;
			}
			displayHalfHeartIcon();
			
			showHalf();
		}
	
		function setUpArrays() {
			ECGurls['Normal'] = 'ECG/NormalECG.json';
			ECGurls['Diastolic'] = 'ECG/DiastolicECG.json';
			ECGurls['Systolic'] = 'ECG/SystolicECG.json';
			LVPurls['Normal'] = 'LVP/NormalLVP.json';
			LVPurls['Diastolic'] = 'LVP/DiastolicLVP.json';
			LVPurls['Systolic'] = 'LVP/SystolicLVP.json';
			ECGurls['NoInfarct'] = 'ECG/NormalECG.json';
			ECGurls['SmallInfarct'] = 'ECG/MildInfarctECG.json';
			ECGurls['LargeInfarct'] = 'ECG/LargeInfarctECG.json';
			LVPurls['NoInfarct'] = 'LVP/NormalLVP.json';
			LVPurls['SmallInfarct'] = 'LVP/smallInfarctLVP.json';
			LVPurls['LargeInfarct'] = 'LVP/largeInfarctLVP.json';
			ECGurls['Arrhythmia'] = 'ECG/ArrhythmiaECG.json';
			LVPurls['Arrhythmia'] = 'LVP/ArrhythmiaLVP.json';
			
			modelURLsArray['DeformingHeart'] = ['models/deforming_heart_metadata.json',
				'models/deforming_heart_view.json'];
			modelURLsArray['NormalElectricity'] = ['heartElectricity/normalActivity_metadata.json',
				'heartElectricity/normalActivity_view.json'];
			modelURLsArray['ArrythmiaElectricity'] = ['heartElectricity/arrythmiaActivity_metadata.json',
				'heartElectricity/arrythmiaActivity_view.json'];
			modelURLsArray['LargeInfarct'] = ['heartInfarct/largeInfarct_metadata.json',
				'heartInfarct/largeInfarct_view.json'];
			modelURLsArray['SmallInfarct'] = ['heartInfarct/smallInfarct_metadata.json',
				'heartInfarct/smallInfarct_view.json'];
			modelURLsArray['NoInfarct'] = ['heartInfarct/noInfarct_metadata.json',
				'heartInfarct/noInfarct_view.json'];
				
			ECGTexts['Normal'] = "electrical pulses make the heart muscle contract";
			LVPTexts['Normal'] = "muscle contraction generates pump pressure";
			ECGTexts['Arrhythmia'] = "Abnormal electrical pattern";
			LVPTexts['Arrhythmia'] = "Very little pressure produced";
			ECGTexts['NoInfarct'] = "Electrical pulses activates heart muscles to squeeze";
			LVPTexts['NoInfarct'] = "Muscles squeezes to increase pressure to push blood out";
			ECGTexts['SmallInfarct'] = "Electrical pulses activates heart muscles to squeeze";
			LVPTexts['SmallInfarct'] = "Dead muscle means less squeeze force and less pressure generated";
			ECGTexts['LargeInfarct'] = "Electrical pulses activates heart muscles to squeeze";
			LVPTexts['LargeInfarct'] = "Dead muscle means less squeeze force and less pressure generated";
		}
		
		
		require(["dojo/ready"], function(ready){
			ready(function(){
				require([ "dojo/_base/declare", "dojo/dom-construct","dojox/charting/Chart", "dojox/charting/plot2d/StackedLines", "dojox/charting/plot2d/Grid", "dojox/charting/themes/Claro", "dojox/charting/axis2d/Default", "dojox/charting/plot2d/Indicator",
				"dojox/charting/themes/Tom"], 
					function(declare, domConstruct, Chart, StackedLines, Grid, Claro, axis2dDefault, plot2dIndicator, tomTheme){
						ready(function(){
								tomTheme.chart.fill="transparent";
								tomTheme.plotarea.fill = "transparent";
								tomTheme.chart.stroke = "transparent";
								/* get the html element (dom) where we want the chart to be drawn on */
								var chartDom = document.getElementById("rightECG");
								/* create the chart on the dom */
								ECGchart = new Chart(chartDom);
								ECGchart.setTheme(tomTheme);
								/* add the x-axis */
								ECGchart.addAxis("x", {type: "Invisible", majorLabels: false,
									minorTicks: false,
									minorLabels: false,
									microTicks: false});		
								/* add the y-axis */
								ECGchart.addAxis("y", {type: "Invisible", vertical: true,
									majorLabels: false,
									minorTicks: false,
									minorLabels: false,
									microTicks: false});
								/* optional add the grid */
								ECGchart.addPlot("grid", { type: Grid,
									hMajorLines: false,
									hMinorLines: false, 
									vMajorLines: false,
									vMinorLines: false,
									majorHLine: { color: "green", width: 0.2 },
									majorVLine: { color: "red", width: 0.2 } });
							   ECGchart.addPlot("time", { type: plot2dIndicator,
				        			vertical: true,
				        			lineStroke: { color: "#00ccff"},
				        			labels: null,
				        			stroke: null,
				        			outline: null,
				        			fill: null,
				        			offset: { y: -7, x: -10 },
				        			values: 0.0});
								ecgIndicator = ECGchart.getPlot("time");
	
								/* get the html element (dom) where we want the chart to be drawn on */
								var chartDom = document.getElementById("rightLVP");
								/* create the chart on the dom */
								LVPchart = new Chart(chartDom);
								LVPchart.setTheme(tomTheme);
								/* add the x-axis */
								LVPchart.addAxis("x", {type: "Invisible",
									majorLabels: false,
									minorTicks: false,
									minorLabels: false,
									microTicks: false});
								/* add the y-axis */
								LVPchart.addAxis("y", {
									vertical: true,
									min: -40,
									max: 160,
									minorTicks: false,
									majorTickStep: 40,
									titleFont: "normal normal normal 11pt Helvetica",
									title:"(mmHg)",
									titleFontColor:[120, 120, 120]
        						});
								/* optional add the grid */
								LVPchart.addPlot("grid", { type: Grid,
									hMajorLines: false,
									hMinorLines: false, 
									vMajorLines: false,
									vMinorLines: false,
									majorHLine: { color: "green", width: 0.2 },
									majorVLine: { color: "red", width: 0.2 } });
								LVPchart.addPlot("time", { type: plot2dIndicator,
				        			vertical: true,
				        			lineStroke: { color: "#00ccff"},
				        			labels: null,
				        			stroke: null,
				        			outline: null,
				        			fill: null,
				        			offset: { y: -7, x: -10 },
				        			values: 0.0});
								lvpIndicator = LVPchart.getPlot("time");
								document.getElementById('rightInformation').className = 'closed';
							});
					});
			});
		});
				
		function loadViewModel(model_name, modelURLs) {
			var scene = zincRenderer.getSceneByName(model_name);
			if (scene == undefined) {
				scene = zincRenderer.createScene(model_name);
				scene.loadFromViewURL(modelURLs);
				scene.resetView();
			}
			zincRenderer.setCurrentScene(scene);
		}
		
		function loadModel(model_name, rateScaling) {
			metaURL = modelURLsArray[model_name][0];
			viewURL = modelURLsArray[model_name][1];
			var scene = zincRenderer.getSceneByName(model_name);
			if (scene == undefined) {
				scene = zincRenderer.createScene(model_name);
				scene.setDuration(scene.getDuration() / rateScaling);
				scene.loadViewURL(viewURL);
				scene.loadMetadataURL(metaURL);
			}
			halfHeartFlag = false;			
			displayHalfHeartIcon();
			showHalf();
			scene.resetView();
			zincRenderer.setCurrentScene(scene);
		}

		function resetView()	{
			zincRenderer.viewAll()
		}
		
		function heartFailureClicked() {
			document.getElementById('heartAttackButtonsContainer').className = 'closed';
			document.getElementById('arrhythmia').className = 'closed';
			document.getElementById('AED').className = 'closed';
			document.getElementById('heartElectrictyButton').classList.remove('selectedItem');
			document.getElementById('heartAttackButton').classList.remove('selectedItem');
			document.getElementById('heartFailureButton').classList.add('selectedItem');
			heartElectrictyButton
			document.getElementById("home_icon").className = 'open';
			document.getElementById("home_selected_icon").className = 'closed';
			updateInfoText("Heart Failure");
		}
		
		function updateSlider(newValue)	{
			zincRenderer.setPlayRate(newValue);
		}
		
		var showLVPInternal = function(chartName) {
			if (chartName != currentLVPName) {
				var currentLVP = LVPs[chartName];
				maxLVPTime = currentLVP[currentLVP.length - 1]['x'];
				minLVPTime = currentLVP[0]['x'];
				LVPchart.removeSeries(currentLVPName);
				currentLVPName = chartName;
				LVPchart.addSeries(chartName, currentLVP, { stroke: {color: "green", width: 2}});
				LVPchart.render();
				LVPchart.resize('100%','100%');
			}
		}
		
		var onLVPLoaded = function(xmlhttp, chartName) {
			return function() {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var viewData = JSON.parse(xmlhttp.responseText);
					LVPs[chartName] = viewData;
					showLVPInternal(chartName);
				}
			};
		}
		
		var showECGInternal = function(chartName) {
			if (chartName != currentECGName) {
				var currentECG = ECGs[chartName];
				maxECGTime = currentECG[currentECG.length - 1]['x'];
				minECGTime = currentECG[0]['x'];
				ECGchart.removeSeries(currentECGName);
				currentECGName = chartName;
				ECGchart.addSeries(chartName, currentECG, { stroke: {color: "orange", width: 2}});
				ECGchart.render();
				ECGchart.resize('100%','100%');
			}
		}
		
		var onECGLoaded = function(xmlhttp, chartName) {
			return function() {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var viewData = JSON.parse(xmlhttp.responseText);
					ECGs[chartName] = viewData;
					showECGInternal(chartName);
				}
			};
		}
		
		function showECGAndLVP(chartName, timeOffset) {
			timeLineOffset = timeOffset;
			if (ECGs[chartName]) {
				showECGInternal(chartName);
			} else {
				var xmlhttp = new XMLHttpRequest();	
				xmlhttp.onreadystatechange = onECGLoaded(xmlhttp, chartName);
				requestURL = ECGurls[chartName];
				xmlhttp.open("GET", requestURL, true);
				xmlhttp.send();
			}
			
			if (LVPs[chartName]) {
				showLVPInternal(chartName);
			} else {
				var xmlhttp = new XMLHttpRequest();	
				xmlhttp.onreadystatechange = onLVPLoaded(xmlhttp, chartName);
				requestURL = LVPurls[chartName];
				xmlhttp.open("GET", requestURL, true);
				xmlhttp.send();
			}
			if (ECGTexts[chartName])
				document.getElementById('ECGDescription').innerHTML = ECGTexts[chartName];
			if (LVPTexts[chartName])
				document.getElementById('LVPDescription').innerHTML = LVPTexts[chartName];
		}
				
	</script>
	
	
	</body>
</html>
